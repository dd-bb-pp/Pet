<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PawPals - å® ç‰©ç¤¾äº¤å¹³å°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- å¼•å…¥Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-paw"></i>
                <span>PawPals</span>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html" class="nav-link active"><i class="fas fa-home"></i> é¦–é¡µ</a></li>
                <li><a href="pet-profile.html" class="nav-link"><i class="fas fa-id-card"></i> å® ç‰©æ¡£æ¡ˆ</a></li>
                <li><a href="community.html" class="nav-link"><i class="fas fa-users"></i> åŒåŸåŠ¨æ€</a></li>
                <li><a href="auth.html" class="nav-link" id="authLink"><i class="fas fa-user"></i> ç™»å½•/æ³¨å†Œ</a></li>
            </ul>
        </div>
    </nav>

    <!-- å¹³å°ç‰¹è‰²åŒº -->
    <section class="features">
        <div class="container">
            <h2 class="section-title">å¹³å°ç‰¹è‰²</h2>
            <div class="features-grid">
                <div class="feature-card pet-profile">
                    <div class="feature-icon">
                        <i class="fas fa-id-card-alt"></i>
                    </div>
                    <h3>å® ç‰©æ¡£æ¡ˆ</h3>
                    <p>è®°å½•å® ç‰©æˆé•¿ç‚¹æ»´ï¼Œå®Œæ•´ç®¡ç†å¥åº·ä¿¡æ¯</p>
                </div>
                <div class="feature-card community">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>åŒåŸç¤¾äº¤</h3>
                    <p>å‘ç°èº«è¾¹å® ç‰©å¥½å‹ï¼Œåˆ†äº«å…»å® ä¹è¶£</p>
                </div>
                <div class="feature-card community">
                    <div class="feature-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3>å…»å® åˆ†äº«</h3>
                    <p>åˆ†äº«å…»å® ç»éªŒå¿ƒå¾—ï¼Œäº¤æµæˆé•¿æ•…äº‹</p>
                </div>
            </div>
        </div>
    </section>

    <!-- åŒåŸçƒ­é—¨åŠ¨æ€ -->
    <section class="hot-trends">
        <div class="container">
            <h2 class="section-title">åŒåŸçƒ­é—¨åŠ¨æ€</h2>
            <div class="trends-grid">
                <div class="trend-card">
                    <div class="user-info">
                        <div class="avatar">C</div>
                        <div class="user-details">
                            <span class="username">é™ˆå°å–µ</span>
                            <span class="pet-name">é‡‘æ¯›Â·å¤šå¤š</span>
                        </div>
                    </div>
                    <div class="trend-content">
                        <p>ä»Šå¤©å¸¦å¤šå¤šå»å…¬å›­æ•£æ­¥ï¼Œé‡åˆ°äº†å¥½å¤šå°ä¼™ä¼´ï¼Œç©å¾—å¯å¼€å¿ƒäº†ï¼</p>
                        <div class="tags">
                            <span class="tag">#æ´»æ³¼</span>
                            <span class="tag">#ç¤¾äº¤</span>
                        </div>
                    </div>
                    <div class="trend-meta">
                        <span><i class="fas fa-map-marker-alt"></i> ä¸Šæµ·å¸‚ä¸­å¿ƒå…¬å›­</span>
                        <span><i class="far fa-clock"></i> 2å°æ—¶å‰</span>
                    </div>
                </div>

                <div class="trend-card">
                    <div class="user-info">
                        <div class="avatar">L</div>
                        <div class="user-details">
                            <span class="username">åˆ˜å°èŠ±</span>
                            <span class="pet-name">æ³¢æ–¯çŒ«Â·æ£‰èŠ±ç³–</span>
                        </div>
                    </div>
                    <div class="trend-content">
                        <p>æ£‰èŠ±ç³–ä»Šå¤©ç”Ÿæ—¥ï¼ä¹°äº†å®ƒæœ€å–œæ¬¢çš„çŒ«ç½å¤´ï¼Œè¿˜æ·»ç½®äº†æ–°ç©å…·</p>
                        <div class="tags">
                            <span class="tag">#ç”Ÿæ—¥</span>
                            <span class="tag">#å¯çˆ±</span>
                        </div>
                    </div>
                    <div class="trend-meta">
                        <span><i class="fas fa-map-marker-alt"></i> åŒ—äº¬å¸‚æµ·æ·€åŒº</span>
                        <span><i class="far fa-clock"></i> 5å°æ—¶å‰</span>
                    </div>
                </div>

                <div class="trend-card">
                    <div class="user-info">
                        <div class="avatar">W</div>
                        <div class="user-details">
                            <span class="username">ç‹æ±ªæ±ª</span>
                            <span class="pet-name">æŸ¯åŸºÂ·è±†è±†</span>
                        </div>
                    </div>
                    <div class="trend-content">
                        <p>è±†è±†ä»Šå¤©å­¦ä¼šäº†æ–°æŠ€èƒ½ï¼Œä¼šæŒ‰é“ƒè¦é¥­äº†ï¼èªæ˜çš„å°å®¶ä¼™</p>
                        <div class="tags">
                            <span class="tag">#èªæ˜</span>
                            <span class="tag">#è®­ç»ƒ</span>
                        </div>
                    </div>
                    <div class="trend-meta">
                        <span><i class="fas fa-map-marker-alt"></i> å¹¿å·å¸‚å¤©æ²³åŒº</span>
                        <span><i class="far fa-clock"></i> 1å¤©å‰</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- å¿«é€Ÿå…¥å£ -->
    <section class="quick-actions">
        <div class="container">
            <h2 class="section-title">å¿«é€Ÿå¼€å§‹</h2>
            <div class="actions-grid">
                <button class="action-btn primary">
                    <i class="fas fa-plus"></i>
                    <span>åˆ›å»ºå® ç‰©æ¡£æ¡ˆ</span>
                </button>
                <button class="action-btn secondary">
                    <i class="fas fa-edit"></i>
                    <span>å‘å¸ƒåŠ¨æ€</span>
                </button>
            </div>
        </div>
    </section>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>å…³äºæˆ‘ä»¬</h3>
                    <p>PawPals è‡´åŠ›äºä¸ºå® ç‰©ä¸»äººæä¾›å…¨æ–¹ä½çš„ç¤¾äº¤å’ŒæœåŠ¡å¹³å°</p>
                </div>
                <div class="footer-section">
                    <h3>è”ç³»æ–¹å¼</h3>
                    <p>é‚®ç®±ï¼šcontact@pawpals.com</p>
                    <p>ç”µè¯ï¼š400-123-4567</p>
                </div>
                <div class="footer-section">
                    <h3>éšç§æ”¿ç­–</h3>
                    <p>æˆ‘ä»¬ä¸¥æ ¼ä¿æŠ¤ç”¨æˆ·éšç§ï¼Œç¡®ä¿ä¿¡æ¯å®‰å…¨</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 PawPals. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
            </div>
        </div>
    </footer>

    <!-- å¼•å…¥Supabaseé…ç½®å’ŒåŠŸèƒ½ -->
    <script src="supabase-config.js"></script>
    <script src="script.js"></script>
    <script>
        // ç­‰å¾…æ•°æ®åº“è¿æ¥å®Œæˆçš„å‡½æ•°
        async function waitForDatabaseConnection(maxWaitTime = 5000) {
            return new Promise((resolve) => {
                const startTime = Date.now();
                
                const checkConnection = () => {
                    if (window.supabaseClient && window.databaseInitialized) {
                        console.log('æ•°æ®åº“è¿æ¥å·²å°±ç»ª');
                        resolve(true);
                        return;
                    }
                    
                    if (Date.now() - startTime > maxWaitTime) {
                        console.warn('ç­‰å¾…æ•°æ®åº“è¿æ¥è¶…æ—¶ï¼Œå°†ä½¿ç”¨åŸºç¡€åŠŸèƒ½');
                        resolve(false);
                        return;
                    }
                    
                    setTimeout(checkConnection, 100);
                };
                
                checkConnection();
            });
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        async function checkUserLoggedIn() {
            if (!window.supabaseClient) {
                console.warn('Supabaseå®¢æˆ·ç«¯æœªåˆå§‹åŒ–');
                return null;
            }
            
            try {
                const { data: { user }, error } = await window.supabaseClient.auth.getUser();
                if (error) {
                    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                    return null;
                }
                
                return user;
            } catch (error) {
                console.error('æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€æ—¶å‘ç”Ÿå¼‚å¸¸:', error);
                return null;
            }
        }
        
        // æ›´æ–°å¯¼èˆªæ æ˜¾ç¤ºå·²ç™»å½•ç”¨æˆ·ä¿¡æ¯
        function updateNavbarForLoggedInUser(user) {
            const authLink = document.getElementById('authLink');
            if (authLink) {
                // è·å–ç”¨æˆ·åï¼ˆä¼˜å…ˆä½¿ç”¨display_nameï¼Œå¦åˆ™ä½¿ç”¨emailå‰ç¼€ï¼‰
                const username = user.user_metadata?.display_name || 
                                user.email?.split('@')[0] || 
                                'ç”¨æˆ·';
                
                authLink.innerHTML = `<i class="fas fa-user"></i> ${username}`;
                authLink.href = '#';
                authLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç”¨æˆ·èœå•æˆ–ä¸ªäººé¡µé¢é“¾æ¥
                    alert(`æ¬¢è¿ï¼Œ${username}ï¼`);
                });
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            // é¦–å…ˆè°ƒç”¨Supabaseåˆå§‹åŒ–
            await initPageSupabase();
            
            // ç­‰å¾…æ•°æ®åº“è¿æ¥å®Œæˆ
            const dbReady = await waitForDatabaseConnection();
            
            if (!dbReady) {
                console.error('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥');
                console.log('ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š');
                console.log('  1. ç½‘ç»œè¿æ¥é—®é¢˜');
                console.log('  2. SupabaseæœåŠ¡æš‚æ—¶ä¸å¯ç”¨');
                console.log('  3. éƒ¨ç½²ç¯å¢ƒçš„CORSé™åˆ¶');
                console.log('  4. APIå¯†é’¥é…ç½®é—®é¢˜');
            }
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
            const user = await checkUserLoggedIn();
            if (user) {
                console.log('ç”¨æˆ·å·²ç™»å½•:', user.email);
                // æ›´æ–°å¯¼èˆªæ æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                updateNavbarForLoggedInUser(user);
            } else {
                console.log('ç”¨æˆ·æœªç™»å½•');
            }
        });
        
        // æ˜¾ç¤ºè¿æ¥è¯Šæ–­ä¿¡æ¯
        function showConnectionDiagnostics() {
            // åœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯
            console.log('=== æ•°æ®åº“è¿æ¥è¯Šæ–­ ===');
            console.log('å½“å‰æ—¶é—´:', new Date().toISOString());
            console.log('Supabaseå®¢æˆ·ç«¯çŠ¶æ€:', window.supabaseClient ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–');
            console.log('æ•°æ®åº“åˆå§‹åŒ–çŠ¶æ€:', window.databaseInitialized);
            
            if (window.supabaseClient) {
                console.log('Supabase URL:', window.supabaseClient.supabaseUrl);
            }
            
            // æ˜¾ç¤ºé¡µé¢URLä¿¡æ¯
            if (typeof window !== 'undefined' && window.location) {
                console.log('å½“å‰é¡µé¢URL:', window.location.href);
                console.log('é¡µé¢åè®®:', window.location.protocol);
                console.log('é¡µé¢åŸŸå:', window.location.hostname);
            }
            
            // æç¤ºç”¨æˆ·æŸ¥çœ‹æ§åˆ¶å°
            if (typeof alert !== 'undefined') {
                alert('è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¸­çš„è¯¦ç»†è¯Šæ–­ä¿¡æ¯ã€‚');
            }
        }
    </script>
</body>
</html>